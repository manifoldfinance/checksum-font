<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <!-- MathJax Config -->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      TeX: {
        equationNumbers: {
          autoNumber: "AMS"
        }
      },
      tex2jax: {
        inlineMath: [ ['$','$'] ],
        displayMath: [ ['\\[','\\]'] ],
        processEscapes: true,
      }
    });
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;1,400;1,600&display=swap');

body {
    max-width: 42em;
    width: 100%;
    margin-left: 0;
    margin-right: 0;
    margin-top: 0;
    padding-top: 1em;
    padding-bottom: 1em;
    padding-left: 2.5em;
    padding-right: 2.5em;
    font-family: "Source Serif Pro";
    background-color: rgb(236, 219, 206);
}

figure {
    text-align: center;
    font-size: small;
    margin: 0;
}

figure img {
    display: block;
    margin-left: auto;
    margin-right: auto;
    max-width: 100%;
}

.title-return {
    font-size: 60%;
}

/* Highlighting */

.highlight {
  margin-bottom: 1rem;
  border-radius: 4px;
}
.highlight pre {
  margin-bottom: 0;
}


.highlight .hll { background-color: #ffc; }
.highlight .c { color: #999; } /* Comment */
.highlight .err { color: #a00; background-color: #faa } /* Error */
.highlight .k { color: #069; } /* Keyword */
.highlight .o { color: #555 } /* Operator */
.highlight .cm { color: #09f; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #099 } /* Comment.Preproc */
.highlight .c1 { color: #999; } /* Comment.Single */
.highlight .cs { color: #999; } /* Comment.Special */
.highlight .gd { background-color: #fcc; border: 1px solid #c00 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #f00 } /* Generic.Error */
.highlight .gh { color: #030; } /* Generic.Heading */
.highlight .gi { background-color: #cfc; border: 1px solid #0c0 } /* Generic.Inserted */
.highlight .go { color: #aaa } /* Generic.Output */
.highlight .gp { color: #009; } /* Generic.Prompt */
.highlight .gs { } /* Generic.Strong */
.highlight .gu { color: #030; } /* Generic.Subheading */
.highlight .gt { color: #9c6 } /* Generic.Traceback */
.highlight .kc { color: #069; } /* Keyword.Constant */
.highlight .kd { color: #069; } /* Keyword.Declaration */
.highlight .kn { color: #069; } /* Keyword.Namespace */
.highlight .kp { color: #069 } /* Keyword.Pseudo */
.highlight .kr { color: #069; } /* Keyword.Reserved */
.highlight .kt { color: #078; } /* Keyword.Type */
.highlight .m { color: #f60 } /* Literal.Number */
.highlight .s { color: #d44950 } /* Literal.String */
.highlight .na { color: #4f9fcf } /* Name.Attribute */
.highlight .nb { color: #366 } /* Name.Builtin */
.highlight .nc { color: #0a8; } /* Name.Class */
.highlight .no { color: #360 } /* Name.Constant */
.highlight .nd { color: #99f } /* Name.Decorator */
.highlight .ni { color: #999; } /* Name.Entity */
.highlight .ne { color: #c00; } /* Name.Exception */
.highlight .nf { color: #c0f } /* Name.Function */
.highlight .nl { color: #99f } /* Name.Label */
.highlight .nn { color: #0cf; } /* Name.Namespace */
.highlight .nt { color: #2f6f9f; } /* Name.Tag */
.highlight .nv { color: #033 } /* Name.Variable */
.highlight .ow { color: #000; } /* Operator.Word */
.highlight .w { color: #bbb } /* Text.Whitespace */
.highlight .mf { color: #f60 } /* Literal.Number.Float */
.highlight .mh { color: #f60 } /* Literal.Number.Hex */
.highlight .mi { color: #f60 } /* Literal.Number.Integer */
.highlight .mo { color: #f60 } /* Literal.Number.Oct */
.highlight .sb { color: #c30 } /* Literal.String.Backtick */
.highlight .sc { color: #c30 } /* Literal.String.Char */
.highlight .sd { color: #c30; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #c30 } /* Literal.String.Double */
.highlight .se { color: #c30; } /* Literal.String.Escape */
.highlight .sh { color: #c30 } /* Literal.String.Heredoc */
.highlight .si { color: #a00 } /* Literal.String.Interpol */
.highlight .sx { color: #c30 } /* Literal.String.Other */
.highlight .sr { color: #3aa } /* Literal.String.Regex */
.highlight .s1 { color: #c30 } /* Literal.String.Single */
.highlight .ss { color: #fc3 } /* Literal.String.Symbol */
.highlight .bp { color: #366 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #033 } /* Name.Variable.Class */
.highlight .vg { color: #033 } /* Name.Variable.Global */
.highlight .vi { color: #033 } /* Name.Variable.Instance */
.highlight .il { color: #f60 } /* Literal.Number.Integer.Long */

.css .o,
.css .o + .nt,
.css .nt + .nt { color: #999; }

</style>

</head>

<body>
    <div class="content container">
      <div class="post">
        <header class="post-header">
          <span>
          <h1 class="post-title">The Anatomy of a Block Stuffing Attack&nbsp<a class="title-return" href="https://solmaz.io/">⤶</a></h1>
          <p class="meta">Oct 18, 2018</p>
          </span>
        </header>
        <article class="post-content">
        <p><em>Block stuffing</em> is a type of attack in blockchains where an attacker submits
transactions that deliberately fill up the block’s gas limit and stall other
transactions. To ensure inclusion of their transactions by miners, the
attacker can choose to pay higher transaction fees. By controlling the
amount of gas spent by their transactions, the attacker can influence the number
of transactions that get to be included in the block.</p>

<p>To control
the amount of gas spent by the transaction, the attacker utilizes a special
contract. There is a function in the contract which takes as input the amount of
gas that the attacker wants to burn. The function runs meaningless
instructions in a loop, and either returns or throws an error when the desired
amount is burned.</p>



<h2 id="miners-strategy-for-selecting-transactions">Miners’ strategy for selecting transactions</h2>

<p>Miners want to maximize their
profit by including transactions with highest fees. In the current PoW
implementation of Ethereum, mining the block takes significantly more time
than executing the transactions. So let’s assume
all transactions in the pool are trivially executed as soon as they arrive
and miners know the amount of gas each one uses.</p>



<style>
table {
    font-family: monospace;
    font-size: small;
}
.highlighted > td {
    background-color: #f6e58d !important;
}
.failed {
    text-decoration: line-through;
    @font-face {
  font-family: 'Checksum';
  font-display: swap;
  font-weight: 400;
  src: url('https://spaces.cache.storage/fonts/checksum/Checksum.woff2') format('woff2');
}
}

</style>

<p>Below are details of the last 4 blocks preceding the end of the round. The rows
highlighted with yellow are transactions submitted by the attacker. The crossed
out rows are failed transactions. All transactions by the attacker were
submitted with a 501 Gwei gas price, and stuffing a single block costed around 4
ETH. The calls to buy keys generally spend around 300,000~500,000 gas, depending
on which function was called.
Below, you see the successfully stuffed
block 6191906.</p>

<table>
<caption><a href="https://etherscan.io/block/6191906">Block 6191906</a></caption>
<tr>
<th>Idx</th>
<th>From</th>
<th>To</th>
<th>Hash</th>
<th>ETH sent</th>
<th>Gas Price<br />[Gwei]</th>
<th>Gas Limit</th>
<th>Gas Used</th>
<th>ETH spent<br />on gas</th>
</tr>
<tr class="failed highlighted">
<td>0</td>
<td><a href="https://etherscan.io/address/0xF033ad4b1D63687efc24620be89aFD07b21B01f2">0xF03…1f2</a></td>
<td><a href="https://etherscan.io/address/0x18e1B664C6a2E88b93C1b71F61Cbf76a726B7801">0x18e…801</a></td>
<td><a href="https://etherscan.io/tx/0xb97d8e39db0fab5bc75c72e2fbbf3f1e2651b1e4c3fde5e2db02ee02db3fb8e4">0xb97…8e4</a></td>
<td>0</td>
<td>501.0</td>
<td>4,200,000</td>
<td>4,200,000</td>
<td>2.1042</td>
</tr>
<tr class="failed highlighted">
<td>1</td>
<td><a href="https://etherscan.io/address/0x87C7BABE2A9Bf81C622a346fFbE57671545854eF">0x87C…4eF</a></td>
<td><a href="https://etherscan.io/address/0x18e1B664C6a2E88b93C1b71F61Cbf76a726B7801">0x18e…801</a></td>
<td><a href="https://etherscan.io/tx/0x96f3038119dcc786820008751380184988e067a3f01c6fbefa177565cc0881b0">0x96f…1b0</a></td>
<td>0</td>
<td>501.0</td>
<td>3,600,000</td>
<td>3,600,000</td>
<td>1.8036</td>
</tr>
<tr class="failed highlighted">
<td>2</td>
<td><a href="https://etherscan.io/address/0xf6E89C15731D611A33DdcbF3274CfAAAe26E1059">0xf6E…059</a></td>
<td><a href="https://etherscan.io/address/0x18e1B664C6a2E88b93C1b71F61Cbf76a726B7801">0x18e…801</a></td>
<td><a href="https://etherscan.io/tx/0x897fc02810f6bbae8d8bc1a32e1e16f442a4c69fa6f77031e86fe546d6e002b3">0x897…2b3</a></td>
<td>0</td>
<td>501.0</td>
<td>200,000</td>
<td>200,000</td>
<td>0.1002</td>
</tr>
<tr>
<th>Sum</th>
<th></th>
<th></th>
<th></th>
<th>0</th>
<th>1503.01</th>
<th>8,000,000</th>
<th>8,000,000</th>
<th>4.0080</th>
</tr>
</table>

<div style="overflow-x: scroll;">

    <table>
      <thead>
        <tr>
          <th>Round</th>
          <th>Address winning the pot</th>
          <th>Winner’s last tx before the end of the round</th>
          <th>Block containing that tx</th>
          <th>Tx ending the round</th>
          <th>Block containing that tx</th>
          <th>Tx where winner withdraws prize</th>
          <th>Amount won [ETH]</th>
          <th>Contract used for block stuffing</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td>0xa169df5ed3363cfc4c92ac96c6c5f2a42fccbf85</td>
          <td>0x7a06d9f11e650fbb2061b320442e26b4a704e1277547e943d73e5b67eb49c349</td>
          <td>6191896</td>
          <td>0xa143a1ee36e1065c3388440ef7e7b38ed41925ca4799c8a4d429fa3ee1966012</td>
          <td>6191909</td>
          <td>0xe08a519c03cb0aed0e04b33104112d65fa1d3a48cd3aeab65f047b2abce9d508</td>
          <td>10,469</td>
          <td>0x18e1b664c6a2e88b93c1b71f61cbf76a726b7801</td>
        </tr>
        <tr>
          <td>2</td>
          <td>0x18a0451ea56fd4ff58f59837e9ec30f346ffdca5</td>
          <td>0x0437885fa741f93acfdcda9f5a2e673bb16d26dd22dfc4890775efb8a94fb583</td>
          <td>6391537</td>
          <td>0x87bf726bc60540c6b91cc013b48024a5b8c1431e0847aadecf0e92c56f8f46fd</td>
          <td>6391548</td>
          <td>0x4da4052d2baffdc9c0b82d628b87d2c76368914e33799032c6966ee8a3c216a0</td>
          <td>3,264</td>
          <td>0x705203fc06027379681AEf47c08fe679bc4A58e1</td>
        </tr>
        <tr>
          <td>3</td>
          <td>0xaf492045962428a15903625B1a9ECF438890eF92</td>
          <td>0x88452b56e9aa58b70321ee8d5c9ac762a62509c98d9a29a4d64d6caae49ae757</td>
          <td>6507761</td>
          <td>0xe6a5a10ec91d12e3fec7e17b0dfbb983e00ffe93d61225735af2e1a8eabde003</td>
          <td>6507774</td>
          <td>0xd7e70fdf58aca40139246a324e871c84d988cfaff673c9e5f384315c91afa5e4</td>
          <td>376</td>
          <td>0xdcC655B2665A675B90ED2527354C18596276B0de</td>
        </tr>
      </tbody>
    </table>
  
  </div>

</div>
</div>
</body>
<footer>
<p>&copy; 2022 <a href="https://twitter.com/prism0x">Onur Solmaz</a></p>
</footer>
</html>